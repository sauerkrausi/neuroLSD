---
title: "HeLaLysoIpASAH1"
output: html_document
date: "2024-12-03"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## laod packages
```{r}

library(gptstudio)
library(plyr)
library(grid)
library(stringr)
library(tidyverse)
library(dplyr)
library(tibble)
library(purrr)
library(rlang)
library(readr)

library(devtools)

library(ggrepel)
library(scales)

library(NatParksPalettes)
library(viridis)
library(RColorBrewer)


library(gridExtra)
library(ggplot2)
library(ggrepel)
##install("gplots")
library(gplots)
library(ggVennDiagram)
library(pheatmap)

#install.packages("magick")
#library(magick)
library(png)

#install.packages("UpSetR")
library(UpSetR)
library(data.table)
library(plotly)
#library(gghighlight)

library(patchwork)
library(grid)
library(cowplot)

#devtools::install_github("jbengler/tidyplots")
library(tidyplots)
```

# output dirs overview:
```{r}
out_dir_lysoip_dataframes <- "/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/Eval/dataframes"
dir.create(out_dir_lysoip_dataframes, recursive = TRUE, showWarnings = FALSE)

out_dir_lysoip_heatmap  <- "/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/Eval/heatmaps"
dir.create(out_dir_lysoip_heatmap, recursive = TRUE, showWarnings = FALSE)

out_dir_lysoip_corrplots <- "/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/Eval/Organelle_CrossCorr"
dir.create(out_dir_lysoip_corrplots, recursive = TRUE, showWarnings = FALSE)

out_dir_lysoip_organelle_dist <- "/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/Eval/Organelle_Distribution"
dir.create(out_dir_lysoip_organelle_dist, recursive = TRUE, showWarnings = FALSE)

out_dir_lysoip_venn <- "/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/Eval/venn"
dir.create(out_dir_lysoip_venn, recursive = TRUE, showWarnings = FALSE)

```

# I. Background HeLa LysoIP experiments
Dataset contains data from isolated lysosomes from HeLa cell lines
Genotypes: HeLa untagged, HeLa TMEM192-3xHA Ctrl, HeLa TMEM192-3xHA ASAH1-/- #6
Samples (all in triplicates): untagged, Ctrl and ASAH1 
9plex_TMTpro & run on Thermo Orbitrap Ascent w/FAIMS-Pro, hrMS2
data was created with MSstats, has p/q.values and log2FC for samples 
k-means clustering was performed on data, is in column "cluster"



# II. Data import, add annotations
```{r}
# read in df
helalysoip_df <- read.csv(
  "/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/20241130_HeLaLysoIP_ASAH1_All_results_stats_localizationAdded.csv",
  header = TRUE
)

# Transform p/q-values to -log10, and filter non-finite log2FCs
log2fc_cols_hela <- c(
"log2FC_CtrlLysoIP.untagged",
"log2FC_ASAH1LysoIP.untagged",
"log2FC_ASAH1LysoIP.CtrlLysoIP"
)

helalysoip_df <- helalysoip_df %>%
  mutate(across(contains("p.val"), ~ ifelse(. > 0, -log10(.), NA), .names = "neg_log10_{.col}"),
         across(contains("q.val"), ~ ifelse(. > 0, -log10(.), NA), .names = "neg_log10_{.col}")) %>%
  filter(if_all(all_of(log2fc_cols_hela), ~ is.finite(.)))


# 1. Define lysohydrolase list
lysohydrolases <- c(
  "ASAH1", "GBA", "ARSA", "ARSB", "GALNS", "IDUA", "GLA", "NEU1", "MAN2B1",
  "GLB1", "HEXA", "GNS", "HEXB", "CTSA", "CTSZ", "TPP1", "NAGLU", "CTSL",
  "CTSB", "NAGA", "LGMN"
)

# 2. Process subcellular annotation
cols_to_read <- c(1,2,3,4,5,6,7,9,10,12,15,16,17,18,19,20,21,22,23,25,26,27,28,29,30,31,32)
subcell_df <- read_csv("/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/neuroLSDgit/proteome/SubCellAnnotation.csv", show_col_types = FALSE)[, cols_to_read]
subcell_df[] <- lapply(subcell_df, as.character)

long_subcell_df <- subcell_df %>%
  pivot_longer(cols = everything(), names_to = "Localization", values_to = "Genes") %>%
  filter(!is.na(Genes) & Genes != "") %>%
  mutate(Genes = trimws(Genes)) %>%
  distinct()

binary_matrix_helalysoip <- long_subcell_df %>%
  mutate(value = TRUE) %>%
  pivot_wider(names_from = Localization, values_from = value, values_fill = list(value = FALSE))

# 3. Annotate helalysoip_df directly
helalysoip_annotated_df <- helalysoip_df %>%
  mutate(LysoHydrolase = Gene.Symbol %in% lysohydrolases) %>%
  left_join(binary_matrix_helalysoip, by = c("Gene.Symbol" = "Genes")) %>%
  mutate(across(where(is.logical) | where(is.numeric), ~ replace_na(., FALSE)))

write.csv(
  helalysoip_annotated_df,
  file = file.path(out_dir_lysoip_dataframes, "helalysoip_annotated.csv"),
  row.names = FALSE
)
```

# III. Heatmaps of dataframe w/ clusters of interst 
```{r}
# z-score heatmap (rows = gene, columns = sample)

# --- 1. Expression and clustering setup
expr_cols_lysoip <- c(
  "untagged_1", "untagged_2", "untagged_3",
  "CtrlLysoIP_1", "CtrlLysoIP_2", "CtrlLysoIP_3",
  "ASAH1LysoIP_1", "ASAH1LysoIP_2", "ASAH1LysoIP_3"
)

mat_helalysoip <- helalysoip_annotated_df %>%
  filter(!is.na(Gene.Symbol)) %>%
  mutate(Gene.Symbol = make.unique(as.character(Gene.Symbol))) %>%
  select(Gene.Symbol, cluster, all_of(expr_cols_lysoip))

row_cluster <- mat_helalysoip$cluster
rownames(mat_helalysoip) <- mat_helalysoip$Gene.Symbol
mat_helalysoip <- mat_helalysoip[, expr_cols_lysoip]
mat_helalysoip <- mat_helalysoip[order(row_cluster), , drop = FALSE]

# --- 2. Row (cluster) annotation
cluster_levels_helalysoip <- sort(unique(na.omit(as.integer(row_cluster))))
row_annotation_helalysoip <- data.frame(
  cluster = factor(row_cluster[order(row_cluster)], levels = cluster_levels_helalysoip)
)
rownames(row_annotation_helalysoip) <- rownames(mat_helalysoip)

cluster_palette_helalysoip <- setNames(
  RColorBrewer::brewer.pal(length(cluster_levels_helalysoip), "Set2")[1:length(cluster_levels_helalysoip)],
  as.character(cluster_levels_helalysoip)
)

ann_colors_helalysoip <- list(
  Genotype = c(Ctrl = "grey40", ASAH1 = "dodgerblue3"),
  cluster = cluster_palette_helalysoip
)

# --- 3. Column (sample) annotation
annotation_col_helalysoip <- tibble(Sample = expr_cols_lysoip) %>%
  mutate(
    Genotype = if_else(str_detect(Sample, "^Ctrl"), "Ctrl", "ASAH1"),
    Fraction = "LysoIP"
  ) %>%
  column_to_rownames("Sample")

ann_colors_helalysoip$Fraction <- c(`Whole-cell` = "#bdbdbd")

# --- 4. Save heatmap and matrix
pdf_file_helalysoip <- file.path(out_dir_lysoip_heatmap, "helalysoip_heatmap.pdf")

cairo_pdf(pdf_file_helalysoip, width = 3, height = 5)
pheatmap(
  mat_helalysoip,
  scale              = "row",
  color              = colorRampPalette(rev(brewer.pal(11, "RdYlBu")))(100),
  annotation_col     = annotation_col_helalysoip,
  annotation_row     = row_annotation_helalysoip,
  annotation_colors  = ann_colors_helalysoip,
  breaks             = seq(-4, 4, length.out = 101),
  cluster_rows       = FALSE,
  cluster_cols       = TRUE,
  show_rownames      = FALSE,
  show_colnames      = TRUE,
  angle_col          = 90,
  main               = "HeLa LysoIP: Ctrl vs ASAH1",
  fontsize           = 6,
  border_color       = NA
)
dev.off()

# Save matrix with clusters
mat_helalysoip_out <- cbind(cluster = row_annotation_helalysoip$cluster, mat_helalysoip)
write.csv(mat_helalysoip_out,
          file = file.path(out_dir_lysoip_heatmap, "helalysoip_heatmap_data.csv"),
          row.names = TRUE)





# Violin plot of cluster abundance
ggplot(annotated_df, aes(x = factor(cluster), y = ASAH1LysoIP)) +
  geom_violin(fill = "dodgerblue", alpha = 0.6) +
  theme_bw()


selected_annot <- c("Lysosome Genes", "Endosome", "ER", "Golgi", "Mito")

long_df <- annotated_df %>%
  filter(Compartment %in% selected_annot) %>%
  pivot_longer(cols = c(CtrlLysoIP, ASAH1LysoIP), names_to = "Condition", values_to = "Abundance")

ggplot(long_df, aes(x = reorder(Compartment, Abundance, FUN = mean), y = Abundance, fill = Condition)) +
  geom_violin(scale = "width", position = position_dodge(width = 0.8)) +
  scale_fill_manual(values = c("CtrlLysoIP" = "gray70", "ASAH1LysoIP" = "dodgerblue")) +
  theme_bw() +
  coord_flip()


# corr
corr_mat <- cor(t(expr_mat), use = "pairwise.complete.obs")
pheatmap(corr_mat, annotation_col = annotated_df[, "Compartment", drop=FALSE])
```


# IV. Violins of clusters of interst 
```{r}
# ─────────────────────────────────────────────────────────────────────────────
# Violin Plot of Cluster Abundance
# ─────────────────────────────────────────────────────────────────────────────

# --- 1. Define sample columns
sample_cols_lysoip <- c(
"log2FC_CtrlLysoIP.untagged",
"log2FC_ASAH1LysoIP.untagged",
"log2FC_ASAH1LysoIP.CtrlLysoIP" 
)

# --- 2. Reshape and clean
violin_df_lysoip <- helalysoip_df %>%
  filter(!is.na(cluster) & cluster != 0) %>%
  pivot_longer(cols = all_of(sample_cols_lysoip), names_to = "Sample", values_to = "log2FC") %>%
  filter(!is.na(log2FC)) %>%
  mutate(cluster = factor(cluster),
         Sample = factor(Sample, levels = sample_cols_lysoip))  # enforce consistent order


# --- 3. Define plot
lysoip_clusterPlot <- ggplot(violin_df_lysoip, aes(x = Sample, y = log2FC, fill = Sample)) +
  geom_jitter(aes(color = "red"), size = 0.5, alpha = 0.2, width = 0.2, height = 0) +
  geom_violin(scale = "width", trim = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  facet_wrap(~ cluster, scales = "free_y") +
  scale_fill_manual(values = c(
    "log2FC_CtrlLysoIP.untagged"     = "#bdc9e1",
    "log2FC_ASAH1LysoIP.untagged"    = "#74a9cf",
    "log2FC_ASAH1LysoIP.CtrlLysoIP"  = "dodgerblue3"
  )) +
  theme_bw(base_size = 10) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
        legend.position = "none") +
  labs(title = "LysoIP: log2FC by Sample per Cluster", x = NULL, y = "log2FC")

# --- 4. Save to PDF
ggsave(file.path(out_dir_lysoip_heatmap, "LysoIP_clusterViolinPlot_log2FC.pdf"),
       lysoip_clusterPlot, width = 6, height = 6, device = cairo_pdf)




# ─────────────────────────────────────────────────────────────────────────────
# Violin Plot of select annotations in ctrl vs ASAH1-/-
# ─────────────────────────────────────────────────────────────────────────────

# --- 1. Define setup
org_mapping <- tibble(
  Organelle = factor(c("Lysosome Genes", "Endo_iN_curated_Hundley", " Golgi Genes", "ER genes", "Mito"), levels = organelles),
  Org_Label = c("Lyso", "Endo", "Golgi", "ER", "Mito"),
  Org_Number = c(1, 2, 3, 4, 5)
)

violin_df <- bind_rows(df_ctrl, df_asah1) %>%
  mutate(Sample = factor(Sample, levels = c("Ctrl vs Untagged", "ASAH1 vs Untagged")),
         Organelle = factor(Organelle, levels = organelles)) %>%
  left_join(org_mapping, by = "Organelle")

# --- 2. Create data subset for both comparisons
df_ctrl <- helalysoip_annotated_df %>%
  filter(if_any(all_of(organelles), ~ .x)) %>%
  select(Gene.Symbol, all_of(organelles), log2FC_CtrlLysoIP.untagged) %>%
  pivot_longer(cols = all_of(organelles), names_to = "Organelle", values_to = "flag") %>%
  filter(flag) %>%
  mutate(Sample = "Ctrl vs Untagged", log2FC = log2FC_CtrlLysoIP.untagged)

df_asah1 <- helalysoip_annotated_df %>%
  filter(if_any(all_of(organelles), ~ .x)) %>%
  select(Gene.Symbol, all_of(organelles), log2FC_ASAH1LysoIP.untagged) %>%
  pivot_longer(cols = all_of(organelles), names_to = "Organelle", values_to = "flag") %>%
  filter(flag) %>%
  mutate(Sample = "ASAH1 vs Untagged", log2FC = log2FC_ASAH1LysoIP.untagged)

# --- 3. Compute mean values for annotation
label_df <- violin_df %>%
  group_by(Organelle, Sample) %>%
  summarize(mean_val = round(mean(log2FC, na.rm = TRUE), 2), .groups = "drop") %>%
  mutate(
    ypos = max(violin_df$log2FC, na.rm = TRUE) + 0.3
  )

# --- 4. Plot
ggplot(violin_df, aes(x = interaction(Organelle, Sample), y = log2FC, fill = Sample)) +
  geom_violin(scale = "width", trim = FALSE, width = 0.9) +
  geom_jitter(width = 0.15, height = 0, size = 0.3, alpha = 0.2) +
  geom_hline(yintercept = 0, linetype = "dotted") +
  scale_fill_manual(values = c("Ctrl vs Untagged" = "grey70", "ASAH1 vs Untagged" = "dodgerblue3")) +
  scale_x_discrete(labels = rep(org_labels, times = 2)) +
  # geom_text(data = label_df,
  #           aes(x = interaction(Organelle, Sample), y = ypos, label = mean_val),
  #           inherit.aes = FALSE,
  #           size = 3,
  #           fontface = "bold",
  #           color = c(rep("black", 5), rep("dodgerblue3", 5))) +
  theme_bw(base_size = 10) +
  theme(
    panel.grid = element_blank(),
    axis.title.x = element_blank(),
    axis.text.x = element_text(angle = 0),
    legend.position = "none"
  ) +
  labs(y = expression(log[2]*"FC"), title = "Organelle Enrichment Ctrl / ASAH1-/-") +
  annotate("text", x = 1:10, y = -4.5, label = rep(org_order, times = 2), color = rep(c("darkorange", "firebrick"), each = 5), size = 3) +
  annotate("text", x = 3, y = -5.2, label = "Ctrl vs Untagged", size = 3.2) +
  annotate("text", x = 8, y = -5.2, label = "ASAH1 vs Untagged", size = 3.2)

# --- 5. Save
ggsave(file.path(out_dir_lysoip_heatmap, "LysoIP_OrganelleEnrichment_ViolinCombo.pdf"), width = 5, height = 5, device = cairo_pdf)



```


# IV. Abundnance of lysosomal hydrolases
```{r}

```


# V. Venn Diagramm of lyso, endo and iN-endo list to see overlap
```{r}
#### Venn for all proteins detected ####
## read in .csv file containing the genes which are sig down in proteomics
lysoIPvenn <- read.csv('/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/EndoLysoIP_venn.csv', 
                   header=T, sep = ",", , stringsAsFactors = FALSE)

#### Venn of all three datasets #####
ggVennDiagram(
  lysoIPvenn,
  category.names = c("Lyso-enriched", "Endo-enriched", "iNendo-enriched"),
  show_intersect = FALSE,
  set_color = "black",
  set_size = NA,
  label = c("both"),
  label_alpha = 0,
  label_geom = c("label"),
  label_color = "black",
  label_size = NA,
  label_percent_digit = 0,
  label_txtWidth = 40,
  edge_lty = "solid",
  edge_size = 0,
) +
  scale_fill_gradient(low = "#F4FAFE", high = "#4981BF")


## save Venn diagram as .pdf for further processing in illustrator for figures 
ggsave('/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/EndoLysoVennDiagramm.pdf', width =20, height = 20, units = "cm", dpi=600)



#### Venn of Lyso and iN endo list #####
## make subset of IP data to only contain lyso and Endocurated list 
lysoIPvenn_subest <- lysoIPvenn[,c("Lyso", "EndoCurated")]

ggVennDiagram(
  lysoIPvenn_subest,
  category.names = c("Lyso-enriched", "iNendo-enriched"),
  show_intersect = FALSE,
  set_color = "black",
  set_size = NA,
  label = c("both"),
  label_alpha = 0,
  label_geom = c("label"),
  label_color = "black",
  label_size = NA,
  label_percent_digit = 0,
  label_txtWidth = 40,
  edge_lty = "solid",
  edge_size = 0,
) +
  scale_fill_gradient(low = "#F4FAFE", high = "#4981BF") +
  coord_flip() ## flip plot on side 


## save Venn diagram as .pdf for further processing in illustrator for figures 
ggsave('/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/EndoCuratedLysoVennDiagramm.pdf', width =27, height = 20, units = "cm", dpi=600)


#### Extract overlapping protein names #### 
## parse and save overlapping protein names that between the lists 
# Convert columns to sets (remove NA values)
lyso_set <- na.omit(lysoIPvenn$Lyso)
endosome_set <- na.omit(lysoIPvenn$Endosome)
endocurated_set <- na.omit(lysoIPvenn$EndoCurated)

# Compute pairwise intersections
overlap_lyso_endosome <- intersect(lyso_set, endosome_set)
overlap_lyso_endocurated <- intersect(lyso_set, endocurated_set)
overlap_endosome_endocurated <- intersect(endosome_set, endocurated_set)

# Save the results to CSV files
write.csv(data.frame(Overlap_Lyso_Endosome = overlap_lyso_endosome),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_Lyso_Endosome.csv', row.names = FALSE)
write.csv(data.frame(Overlap_Lyso_EndoCurated = overlap_lyso_endocurated),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_Lyso_EndoCurated.csv', row.names = FALSE)
write.csv(data.frame(Overlap_Endosome_EndoCurated = overlap_endosome_endocurated),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_Endosome_EndoCurated.csv', row.names = FALSE)



#### Analysis for enriched protein (log2FC >0.5) in Ctrl over untagged ####

## read in .csv file containing the genes which are sig down in proteomics
lysoIPvennCtrl <- read.csv('/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/EndoLysoIP_vennCtrl.csv', 
                   header=T, sep = ",", , stringsAsFactors = FALSE)

## make subset of IP data to only contain lyso and Endocurated list 
lysoIPvennCtrl_subest <- lysoIPvennCtrl[,c("Lyso", "EndoCurated")]

ggVennDiagram(
  lysoIPvennCtrl_subest,
  category.names = c("Lyso-enriched", "iNendo-enriched"),
  show_intersect = FALSE,
  set_color = "black",
  set_size = NA,
  label = c("both"),
  label_alpha = 0,
  label_geom = c("label"),
  label_color = "black",
  label_size = NA,
  label_percent_digit = 0,
  label_txtWidth = 40,
  edge_lty = "solid",
  edge_size = 0,
) +
  scale_fill_gradient(low = "#F4FAFE", high = "#4981BF") +
  coord_flip() ## flip plot on side 


## save Venn diagram as .pdf for further processing in illustrator for figures 
ggsave('/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/EndoCuratedLysoVennDiagrammCtrl.pdf', width =27, height = 20, units = "cm", dpi=600)

### Ctrl over untagged: Extract overlapping protein names 
## parse and save overlapping protein names that between the lists 
# Convert columns to sets (remove NA values)
lyso_Ctrl_set <- na.omit(lysoIPvennCtrl$Lyso)
endosome_Ctrl_set <- na.omit(lysoIPvennCtrl$Endosome)
endocurated_Ctrl_set <- na.omit(lysoIPvennCtrl$EndoCurated)

# Compute pairwise intersections
overlap_Ctrl_lyso_endosome <- intersect(lyso_Ctrl_set, endosome_Ctrl_set)
overlap_Ctrl_lyso_endocurated <- intersect(lyso_Ctrl_set, endocurated_Ctrl_set)
overlap_Ctrl_endosome_endocurated <- intersect(endosome_Ctrl_set, endocurated_Ctrl_set)

# Save the results to CSV files
write.csv(data.frame(Overlap_Ctrl_Lyso_Endosome = overlap_Ctrl_lyso_endosome),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_Ctrl_Lyso_Endosome.csv', row.names = FALSE)
write.csv(data.frame(Overlap_Ctrl_Lyso_EndoCurated = overlap_Ctrl_lyso_endocurated),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_Ctrl_Lyso_EndoCurated.csv', row.names = FALSE)
write.csv(data.frame(Overlap_Ctrl_Endosome_EndoCurated = overlap_Ctrl_endosome_endocurated),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_Ctrl_Endosome_EndoCurated.csv', row.names = FALSE)



#### Analysis for enriched protein (log2FC >0.5) in ASAH1 over untagged ####

## read in .csv file containing the genes which are sig down in proteomics
lysoIPvennASAH1 <- read.csv('/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/EndoLysoIP_vennASAH1.csv', 
                   header=T, sep = ",", , stringsAsFactors = FALSE)

## make subset of IP data to only contain lyso and Endocurated list 
lysoIPvennASAH1_subest <- lysoIPvennASAH1[,c("Lyso", "EndoCurated")]

ggVennDiagram(
  lysoIPvennASAH1_subest,
  category.names = c("Lyso-enriched", "iNendo-enriched"),
  show_intersect = FALSE,
  set_color = "black",
  set_size = NA,
  label = c("both"),
  label_alpha = 0,
  label_geom = c("label"),
  label_color = "black",
  label_size = NA,
  label_percent_digit = 0,
  label_txtWidth = 40,
  edge_lty = "solid",
  edge_size = 0,
) +
  scale_fill_gradient(low = "#F4FAFE", high = "#4981BF") +
  coord_flip() ## flip plot on side 


## save Venn diagram as .pdf for further processing in illustrator for figures 
ggsave('/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/EndoCuratedLysoVennDiagrammASAH1.pdf', width =27, height = 20, units = "cm", dpi=600)

### Ctrl over untagged: Extract overlapping protein names 
## parse and save overlapping protein names that between the lists 
# Convert columns to sets (remove NA values)
lyso_ASAH1_set <- na.omit(lysoIPvennASAH1$Lyso)
endosome_ASAH1_set <- na.omit(lysoIPvennASAH1$Endosome)
endocurated_ASAH1_set <- na.omit(lysoIPvennASAH1$EndoCurated)

# Compute pairwise intersections
overlap_ASAH1_lyso_endosome <- intersect(lyso_ASAH1_set, endosome_ASAH1_set)
overlap_ASAH1_lyso_endocurated <- intersect(lyso_ASAH1_set, endocurated_ASAH1_set)
overlap_ASAH1_endosome_endocurated <- intersect(endosome_ASAH1_set, endocurated_ASAH1_set)

# Save the results to CSV files
write.csv(data.frame(Overlap_ASAH1_Lyso_Endosome = overlap_ASAH1_lyso_endosome),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_ASAH1_Lyso_Endosome.csv', row.names = FALSE)
write.csv(data.frame(Overlap_ASAH1_Lyso_EndoCurated = overlap_ASAH1_lyso_endocurated),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_ASAH1_Lyso_EndoCurated.csv', row.names = FALSE)
write.csv(data.frame(Overlap_ASAH1_Endosome_EndoCurated = overlap_ASAH1_endosome_endocurated),
          '/Users/felix/Dropbox (HMS)/Felix/Harvard/03_LSD-PD/Proteomics/20241119_HeLa_Ctrl-ASAH1_LysoIP/MSstats/OrganelleEval/Overlap_ASAH1_Endosome_EndoCurated.csv', row.names = FALSE)



```


