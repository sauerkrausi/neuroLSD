---
title: "HeLa Endo-lyso imaging eval"
output: html_document
date: "2025-08-10"
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# I. Load packackes
```{r}
library(devtools)
# Core data manipulation 
library(tidyverse)
library(Cairo)
library(readr)
library(dplyr)
library(stringr)
library(tidyr)
library(ggplot2)
library(tibble)
library(purrr)
library(patchwork)

# For PDF export
library(Cairo)    

# Tidy evaluation helpers (used in dplyr/mutate etc.)
library(rlang)



library(tidyverse)
library(readr)
library(stringr)
library(rstatix) 
library(janitor)


```


# II. TFN-488 uptake an coloc eval with EEA1
```{r}
# ------------------------------------------
# Color of 5min or 45min incubated TFN-488 in
# HeLa Control and ASAH1-/- 
# ------------------------------------------

# --- 1. Path to your metrics
metrics_dir <- "/Volumes/Expansion/Harvard/NIC/LucilleTwo/Project_neuroLSD/20250121_HeLa-Ctrl-ASAH1_TFN-488_uptakeAssay/pyeval/metrics"
outdir <- "/Users/felix/HMS Dropbox/Felix Kraus/Felix/Harvard/03_LSD-PD/Microscopy/20250121_HeLa-Ctrl-ASAH1_TFN-488_uptakeAssay/pyEval"

# --- 2. read files
coloc_df <- read_csv(file.path(metrics_dir, "pairwise_colocalization.csv"), show_col_types = FALSE) %>%
  clean_names()

summary_df <- read_csv(file.path(metrics_dir, "per_image_summary.csv"), show_col_types = FALSE) %>%
  clean_names()


# --- 3. Helper function to parse though python output files 
parse_sample_meta <- function(tbl_in) {
  tbl_in %>%
    mutate(
      geno_raw = str_extract(sample, "(?<![A-Za-z0-9])(Ctrl|ASAH1)(?![A-Za-z0-9])"),
      genotype = case_when(
        geno_raw == "Ctrl"  ~ "Control",
        geno_raw == "ASAH1" ~ "ASAH1",
        TRUE ~ NA_character_
      ),
      trt_raw = str_extract(sample, "(?<![A-Za-z0-9])(5min|45min)(?![A-Za-z0-9])"),
      treatment = case_when(
        trt_raw == "5min"  ~ "5 min",
        trt_raw == "45min" ~ "45 min",
        TRUE ~ NA_character_
      ),
      genotype = factor(genotype, levels = c("Control", "ASAH1")),
      treatment = factor(treatment, levels = c("5 min", "45 min"))
    ) %>%
    select(-geno_raw, -trt_raw)
}

coloc_df <- parse_sample_meta(coloc_df)
summary_df <- parse_sample_meta(summary_df)



# --- 4. Set colors for plot 
hela_genotype_colors <- c(
  "Control" = "grey80",
  "ASAH1"   = "dodgerblue"
)

# establish combined x order: Control 5, Control 45, ASAH1 5, ASAH1 45
coloc_df <- coloc_df %>%
  mutate(
    genotype_treatment = factor(
      paste(genotype, treatment, sep = "_"),
      levels = c(
        "Control_5 min",
        "Control_45 min",
        "ASAH1_5 min",
        "ASAH1_45 min"
      )
    )
  )


# --- 5. Wilcoxon tests: Control vs ASAH1 within each treatment on frac_coloc_eea1
stats_tbl <- coloc_df %>%
  filter(!is.na(frac_coloc_eea1), !is.na(genotype), !is.na(treatment)) %>%
  group_by(treatment) %>%
  wilcox_test(frac_coloc_eea1 ~ genotype) %>%
  ungroup() %>%
  mutate(
    p_adj = p.adjust(p, method = "BH"),
    p_stars = case_when(
      is.na(p_adj) ~ "n.a.",
      p_adj < 0.001 ~ "***",
      p_adj < 0.01  ~ "**",
      p_adj < 0.05  ~ "*",
      TRUE ~ "ns"
    )
  )

# y positions for labels and x positions above ASAH1 for each treatment
y_pos_tbl <- coloc_df %>%
  group_by(treatment) %>%
  summarise(y_pos = max(frac_coloc_eea1, na.rm = TRUE) * 1.05, .groups = "drop")

levels_gt <- levels(coloc_df$genotype_treatment)

stats_for_plot <- stats_tbl %>%
  left_join(y_pos_tbl, by = "treatment") %>%
  mutate(
    x_label = paste0("ASAH1_", treatment),
    x_pos   = match(x_label, levels_gt),
    p_text  = paste0("BH p: ", signif(p_adj, 3), "  ", p_stars)
  )

# --- 6 . plot frac_coloc_eea1 by genotype and treatment (violin + box + jitter) with p labels
# save plot as pdf
plot_frac_coloc_eea1 <- ggplot(coloc_df, aes(x = genotype_treatment, y = frac_coloc_eea1, fill = genotype)) +
  geom_jitter(width = 0.1, size = 1, alpha = 0.6) +
  geom_violin(trim = FALSE, linewidth = 0.2, alpha =0.6) +
  geom_boxplot(width = 0.2, outlier.shape = NA, alpha = 0.85, fill = "white") +
  scale_fill_manual(values = hela_genotype_colors) +
  labs(x = "Genotype + Treatment", y = "Fraction of EEA1 colocalized") +
  theme_bw() +
  theme(panel.grid = element_blank(), legend.position = "none") +
  geom_text(
    data = stats_for_plot,
    aes(x = x_pos, y = y_pos, label = p_text),
    inherit.aes = FALSE,
    size = 3
  )

print(plot_frac_coloc_eea1)
ggsave(file.path(outdir, "HeLa_EEA1-TFN_coloc.pdf"), plot_frac_coloc_eea1, width = 3, height = 5, device = cairo_pdf)


# --- 7. Write annotated CSVs with stats columns merged by treatment
coloc_df %>%
  left_join(stats_tbl %>% select(treatment, p, p_adj, p_stars), by = "treatment") %>%
  write_csv(file.path(outdir, "pairwise_colocalization_annotated.csv"))

summary_df %>%
  left_join(stats_tbl %>% select(treatment, p, p_adj, p_stars), by = "treatment") %>%
  write_csv(file.path(outdir, "per_image_summary_annotated.csv"))


# --- 8. also save the stats table itself
write_csv(stats_tbl, file.path(outdir, "EEA1_coloc_wilcoxon_by_treatment.csv"))
  
```




# III. HeLa endo-lysosomal stain evaluation
```{r}
# ------------------------------------------
# Color and quant eval of endo-lyso stains
# HeLa Control and ASAH1-/-
# ------------------------------------------

# --- 1. User inputs and outputs
hela_base_dir <- "/Users/felix/HMS Dropbox/Felix Kraus/Felix/Harvard/03_LSD-PD/Microscopy/20250613_HeLa-Ctrl-ASAH1_EndoLysoStains/cpsamEL/eval"

hela_genotype_colors <- c(
  "Control" = "grey80",
  "ASAH1"   = "dodgerblue"
)

hela_out_dir <- file.path(hela_base_dir, "figures")
dir.create(hela_out_dir, showWarnings = FALSE, recursive = TRUE)


# --- 2. IO helper functions
hela_read_metrics_pairwise <- function(metrics_dir) {
  f <- file.path(metrics_dir, "pairwise_colocalization.csv")
  if (!file.exists(f)) return(NULL)
  readr::read_csv(f, show_col_types = FALSE)
}

hela_read_metrics_summary <- function(metrics_dir) {
  f <- file.path(metrics_dir, "per_image_summary.csv")
  if (!file.exists(f)) return(NULL)
  readr::read_csv(f, show_col_types = FALSE)
}


# --- 3. Parsing helper functions
hela_get_genotype <- function(x_prefix) {
  ifelse(stringr::str_detect(x_prefix, stringr::regex("ASAH1", ignore_case = TRUE)),
         "ASAH1", "Control")
}


# --- 4. Build data frames by looping through subfolders 
hela_subdirs_vec <- list.dirs(hela_base_dir, full.names = TRUE, recursive = FALSE)

hela_pairwise_list <- list()
hela_summary_list  <- list()

for (sd in hela_subdirs_vec) {
  metrics_dir <- file.path(sd, "metrics")
  if (!dir.exists(metrics_dir)) next

  pw_df <- hela_read_metrics_pairwise(metrics_dir)
  sm_df <- hela_read_metrics_summary(metrics_dir)

  if (!is.null(pw_df)) {
    pw_df <- pw_df %>%
      mutate(
        genotype = hela_get_genotype(prefix),
        pair = paste(stainA, stainB, sep = "_"),
        src_combo = basename(sd)
      )
    hela_pairwise_list[[length(hela_pairwise_list) + 1]] <- pw_df
  }

  if (!is.null(sm_df)) {
    sm_df <- sm_df %>%
      mutate(
        genotype = hela_get_genotype(prefix),
        src_combo = basename(sd)
      )
    hela_summary_list[[length(hela_summary_list) + 1]] <- sm_df
  }
}

HeLa_colocalization_df <- bind_rows(hela_pairwise_list) %>%
  relocate(genotype, .after = prefix) %>%
  mutate(genotype = factor(genotype, levels = c("Control", "ASAH1")))

HeLa_summary_df <- bind_rows(hela_summary_list) %>%
  relocate(genotype, .after = prefix) %>%
  mutate(genotype = factor(genotype, levels = c("Control", "ASAH1")))

# keep raw copies for per-metric cleaning downstream
HeLa_colocalization_raw <- HeLa_colocalization_df
HeLa_summary_raw        <- HeLa_summary_df


# --- CLEANING: remove non-finite, out-of-range, and outliers
# metric properties
hela_metric_specs <- tibble::tibble(
  metric  = c("coloc_per_nucleus","frac_coloc_A","frac_coloc_B",
              "avg_area_HA","avg_area_EEA1","avg_area_VPS35","avg_area_LAMP1","avg_area_RAB7",
              "HA_per_nucleus","EEA1_per_nucleus","VPS35_per_nucleus","LAMP1_per_nucleus","RAB7_per_nucleus"),
  clamp01 = c(FALSE, TRUE, TRUE,
              FALSE, FALSE, FALSE, FALSE, FALSE,
              FALSE, FALSE, FALSE, FALSE, FALSE),
  nonneg  = c(TRUE,  TRUE, TRUE,
              TRUE,  TRUE,  TRUE,  TRUE,  TRUE,
              TRUE,  TRUE,  TRUE,  TRUE,  TRUE)
)

hela_flag_outliers <- function(df, group_vars, value_col, method="mad", k_mad=3){
  spec <- hela_metric_specs %>% dplyr::filter(metric == value_col)
  clamp01 <- ifelse(nrow(spec)>0, spec$clamp01, FALSE)
  nonneg  <- ifelse(nrow(spec)>0, spec$nonneg,  FALSE)
  df %>% 
    dplyr::mutate(.val = .data[[value_col]],
                  .finite = is.finite(.val),
                  .inrange = TRUE) %>%
    { if (clamp01) dplyr::mutate(., .inrange = .inrange & (.val >= 0 & .val <= 1)) else . } %>%
    { if (nonneg)  dplyr::mutate(., .inrange = .inrange & (.val >= 0))            else . } %>%
    dplyr::mutate(.keep_basic = .finite & .inrange) %>%
    dplyr::group_by(dplyr::across(all_of(group_vars))) %>%
    dplyr::mutate(
      .med = suppressWarnings(stats::median(.val[.keep_basic], na.rm = TRUE)),
      .mad = suppressWarnings(stats::mad(.val[.keep_basic], constant = 1.4826, na.rm = TRUE))
    ) %>%
    dplyr::mutate(
      .mad = ifelse(is.finite(.mad) & .mad > 0, .mad, NA_real_),
      .low = ifelse(is.na(.mad), -Inf, .med - k_mad*.mad),
      .high= ifelse(is.na(.mad),  Inf, .med + k_mad*.mad)
    ) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(
      .outlier_num = .keep_basic & (.val < .low | .val > .high),
      .drop = !.keep_basic | .outlier_num,
      .reason = dplyr::case_when(
        !.finite ~ "nonfinite",
        .finite & !.inrange ~ "out_of_range",
        .outlier_num ~ paste0("outlier_", method),
        TRUE ~ "keep"
      )
    )
}

# clean colocalization metrics
coloc_metrics_vec <- c("coloc_per_nucleus","frac_coloc_A","frac_coloc_B")
for (m in coloc_metrics_vec) {
  if (!m %in% names(HeLa_colocalization_df)) next
  flagged <- hela_flag_outliers(HeLa_colocalization_df, c("pair","genotype"), m)
  readr::write_csv(flagged %>% dplyr::filter(.drop),
                   file.path(hela_out_dir, paste0("REMOVED_", m, ".csv")))
}
# clean summary metrics
summary_metrics_all <- c("avg_area_HA","avg_area_EEA1","avg_area_VPS35","avg_area_LAMP1","avg_area_RAB7",
                         "HA_per_nucleus","EEA1_per_nucleus","VPS35_per_nucleus","LAMP1_per_nucleus","RAB7_per_nucleus")
for (m in summary_metrics_all) {
  if (!m %in% names(HeLa_summary_df)) next
  flagged <- hela_flag_outliers(HeLa_summary_df, c("genotype"), m)
  readr::write_csv(flagged %>% dplyr::filter(.drop),
                   file.path(hela_out_dir, paste0("REMOVED_", m, ".csv")))
}

# --- 5. Statistics helper functions
hela_wilcox_by_group <- function(in_df, group_var, value_col) {
  stopifnot(group_var %in% names(in_df), value_col %in% names(in_df))
  in_df %>%
    select(all_of(group_var), genotype, !!sym(value_col)) %>%
    filter(!is.na(.data[[value_col]])) %>%
    group_by(.data[[group_var]]) %>%
    do({
      if (dplyr::n_distinct(.$genotype) < 2) tibble(statistic = NA_real_, p = NA_real_)
      else {
        wt <- rstatix::wilcox_test(reformulate("genotype", response = value_col), data = .)
        tibble(statistic = wt$statistic, p = wt$p)
      }
    }) %>%
    ungroup() %>%
    mutate(
      p_adj = p.adjust(p, method = "BH"),
      p_label = case_when(
        is.na(p_adj) ~ "n.a.",
        p_adj < 0.001 ~ "***",
        p_adj < 0.01  ~ "**",
        p_adj < 0.05  ~ "*",
        TRUE          ~ "ns"
      )
    )
}


# --- 6. Add stats to data frames
# 6a. Pairwise colocalization stats per metric per pair
for (m_name in coloc_metrics_vec) {
  if (!m_name %in% names(HeLa_colocalization_raw)) next
  cl <- hela_flag_outliers(HeLa_colocalization_raw, c("pair","genotype"), m_name) %>%
        dplyr::filter(!.drop)
  df_m <- cl %>% dplyr::select(-dplyr::starts_with("."))  # strip aux columns
  stat_tbl_m <- hela_wilcox_by_group(df_m, "pair", m_name) %>%
    dplyr::select(pair,
      !!rlang::sym(paste0("p_adj_", m_name)) := p_adj,
      !!rlang::sym(paste0("p_label_", m_name)) := p_label,
      !!rlang::sym(paste0("statistic_", m_name)) := statistic)
  HeLa_colocalization_df <- HeLa_colocalization_raw %>%
    dplyr::left_join(stat_tbl_m, by = "pair")
}
# write summary csv colocalization
readr::write_csv(HeLa_colocalization_df,file.path(hela_out_dir, "HeLa_colocalization_with_stats.csv"))


# 6b. Summary stats per metric across images
if ("n_EEA1_per_nucleus" %in% names(HeLa_summary_df) && !("EEA1_per_nucleus" %in% names(HeLa_summary_df))) {
  HeLa_summary_df <- HeLa_summary_df %>% rename(EEA1_per_nucleus = n_EEA1_per_nucleus)
}
if ("n_VPS35_per_nucleus" %in% names(HeLa_summary_df) && !("VPS35_per_nucleus" %in% names(HeLa_summary_df))) {
  HeLa_summary_df <- HeLa_summary_df %>% rename(VPS35_per_nucleus = n_VPS35_per_nucleus)
}
if ("n_LAMP1_per_nucleus" %in% names(HeLa_summary_df) && !("LAMP1_per_nucleus" %in% names(HeLa_summary_df))) {
  HeLa_summary_df <- HeLa_summary_df %>% rename(LAMP1_per_nucleus = n_LAMP1_per_nucleus)
}
if ("n_RAB7_per_nucleus" %in% names(HeLa_summary_df) && !("RAB7_per_nucleus" %in% names(HeLa_summary_df))) {
  HeLa_summary_df <- HeLa_summary_df %>% dplyr::rename(RAB7_per_nucleus = n_RAB7_per_nucleus)
}

summary_avg_metrics_vec     <- c("avg_area_HA","avg_area_EEA1","avg_area_VPS35","avg_area_LAMP1","avg_area_RAB7")
summary_pernuc_metrics_vec  <- c("HA_per_nucleus","EEA1_per_nucleus","VPS35_per_nucleus","LAMP1_per_nucleus","RAB7_per_nucleus")

hela_add_summary_stats <- function(df_in, metric_names, adjust_scope_label) {
  present_metrics <- intersect(metric_names, names(df_in))
  if (length(present_metrics) == 0) return(df_in)

  stats_list <- lapply(present_metrics, function(mn) {
    cl <- hela_flag_outliers(df_in, c("genotype"), mn) %>% dplyr::filter(!.drop)
    df_m <- cl %>% dplyr::select(genotype, !!rlang::sym(mn)) %>% dplyr::mutate(metric = mn)
    st <- hela_wilcox_by_group(df_m, "metric", mn)
    st$metric <- mn
    st
  })

  stats_df <- dplyr::bind_rows(stats_list) %>%
    dplyr::mutate(
      p_adj = p.adjust(p, method = "BH"),
      p_label = dplyr::case_when(
        is.na(p_adj) ~ "n.a.", p_adj < 0.001 ~ "***",
        p_adj < 0.01 ~ "**",  p_adj < 0.05  ~ "*", TRUE ~ "ns"
      )
    )

  df_out <- df_in
  for (mn in present_metrics) {
    row_m <- stats_df %>% dplyr::filter(metric == mn) %>% dplyr::slice(1)
    df_out[[paste0("p_adj_", mn)]]     <- row_m$p_adj
    df_out[[paste0("p_label_", mn)]]   <- row_m$p_label
    df_out[[paste0("statistic_", mn)]] <- row_m$statistic
  }

  readr::write_csv(stats_df %>% dplyr::select(metric, statistic, p, p_adj, p_label),
                   file.path(hela_out_dir, paste0("HeLa_summary_stats_", adjust_scope_label, ".csv")))
  df_out
}

HeLa_summary_df <- HeLa_summary_df %>%
  hela_add_summary_stats(summary_avg_metrics_vec, "avg_area") %>%
  hela_add_summary_stats(summary_pernuc_metrics_vec, "per_nucleus")
readr::write_csv(HeLa_summary_df,file.path(hela_out_dir, "HeLa_summary_with_stats.csv"))


# --- 7. Plotting helpers
## function for plotting colocalisation
hela_plot_coloc_metric <- function(input_df, y_col, y_lab, out_name, palette_vec) {
  stopifnot(y_col %in% names(input_df))
  cl <- hela_flag_outliers(input_df, c("pair","genotype"), y_col) %>% dplyr::filter(!.drop)
  if (nrow(cl) == 0) { warning("No data left to plot after cleaning for metric: ", y_col); return(invisible(NULL)) }

  stats_tbl <- cl %>% dplyr::select(pair, genotype, !!rlang::sym(y_col)) %>%
    dplyr::group_by(pair) %>%
    dplyr::do({
      if (dplyr::n_distinct(.$genotype) < 2) tibble::tibble(statistic=NA_real_, p=NA_real_)
      else { wt <- rstatix::wilcox_test(reformulate("genotype", response = y_col), data = .)
             tibble::tibble(statistic = wt$statistic, p = wt$p) }
    }) %>% dplyr::ungroup() %>%
    dplyr::mutate(p_adj = p.adjust(p, method = "BH"),
                  p_label = dplyr::case_when(is.na(p_adj)~"n.a.", p_adj<0.001~"***", p_adj<0.01~"**", p_adj<0.05~"*", TRUE~"ns"))
  y_pos_tbl <- cl %>% dplyr::group_by(pair) %>% dplyr::summarize(y_pos = max(.data[[y_col]], na.rm = TRUE) * 1.05, .groups = "drop")
  stats_for_plot <- dplyr::left_join(stats_tbl, y_pos_tbl, by = "pair")

  plot_color_metric <- ggplot(cl, aes(x = genotype, y = .data[[y_col]], fill = genotype)) +
    geom_violin(trim = FALSE, linewidth = 0.2) +
    geom_boxplot(width = 0.15, outlier.shape = NA, fill = "white") +
    geom_jitter(width = 0.12, alpha = 0.6, size = 0.9) +
    scale_fill_manual(values = palette_vec) +
    labs(title = y_lab, x = "Genotype", y = y_lab) +
    facet_wrap(~ pair, scales = "free_y", nrow = 1) +
    theme_bw(base_size = 6) +
    theme(panel.grid = element_blank(), legend.position = "none",
                   strip.background = element_rect(fill = "grey95", color = "grey80")) +
    geom_text(data = stats_for_plot, aes(x = 1.5, y = y_pos, label = paste0("BH p: ", signif(p_adj, 3), "  ", p_label)),
                       inherit.aes = FALSE, size = 3)
  ggsave(file.path(hela_out_dir, out_name), plot_color_metric, width = 15, height = 3)
}

## function for plotting number and area per comparison 
hela_plot_summary_metrics <- function(input_df, metric_vec, title_txt, out_name, palette_vec) {
  metric_vec <- intersect(metric_vec, names(input_df))
  if (length(metric_vec) == 0) { warning("No requested metrics found for ", out_name); return(invisible(NULL)) }

  cleaned_list <- lapply(metric_vec, function(mn) {
    cl <- hela_flag_outliers(input_df, c("genotype"), mn) %>% dplyr::filter(!.drop)
    if (nrow(cl) == 0) return(NULL)
    cl %>%
      dplyr::select(genotype, !!rlang::sym(mn)) %>%
      dplyr::mutate(metric = mn) %>%
      dplyr::rename(value = !!rlang::sym(mn))
  })
  long_df <- cleaned_list %>% purrr::compact() %>% dplyr::bind_rows()
  if (is.null(long_df) || nrow(long_df) == 0) { warning("No data left to plot after cleaning for: ", paste(metric_vec, collapse = ", ")); return(invisible(NULL)) }

  # stats per metric
  stats_tbl <- long_df %>%
    dplyr::group_by(metric) %>%
    dplyr::do({
      if (dplyr::n_distinct(.$genotype) < 2) tibble::tibble(statistic = NA_real_, p = NA_real_)
      else {
        wt <- rstatix::wilcox_test(value ~ genotype, data = .)
        tibble::tibble(statistic = wt$statistic, p = wt$p)
      }
    }) %>%
    dplyr::ungroup() %>%
    dplyr::mutate(
      p_adj = p.adjust(p, method = "BH"),
      p_label = dplyr::case_when(
        is.na(p_adj) ~ "n.a.",
        p_adj < 0.001 ~ "***",
        p_adj < 0.01  ~ "**",
        p_adj < 0.05  ~ "*",
        TRUE          ~ "ns"
      )
    )

  y_pos_tbl <- long_df %>%
    dplyr::group_by(metric) %>%
    dplyr::summarise(y_pos = max(value, na.rm = TRUE) * 1.05, .groups = "drop")

  stats_for_plot <- dplyr::left_join(stats_tbl, y_pos_tbl, by = "metric")

  plot_summary <- ggplot(long_df, aes(x = genotype, y = value, fill = genotype)) +
    geom_violin(trim = FALSE, linewidth = 0.2) +
    geom_boxplot(width = 0.25, outlier.shape = NA, fill = "white") +
    geom_jitter(width = 0.12, alpha = 0.6, size = 0.9) +
    scale_fill_manual(values = palette_vec) +
    labs(title = title_txt, x = "Genotype", y = NULL) +
    facet_wrap(~ metric, scales = "free_y", nrow = 1) +
    theme_bw(base_size = 6) +
    theme(
      panel.grid = element_blank(),
      legend.position = "none",
      strip.background = element_rect(fill = "grey95", color = "grey80")
    ) +
    geom_text(
      data = stats_for_plot,
      aes(x = 1.5, y = y_pos, label = paste0("BH p: ", signif(p_adj, 3), "  ", p_label)),
      inherit.aes = FALSE,
      size = 3
    )

  ggsave(file.path(hela_out_dir, out_name), plot_summary, width = 15, height = 3)
}


# --- 8. Call plotting function to create plots
hela_plot_coloc_metric(
  HeLa_colocalization_df, "frac_coloc_A",
  "Fraction colocalized in A", "HeLa_frac_coloc_A_by_genotype.pdf",
  hela_genotype_colors
)
hela_plot_coloc_metric(
  HeLa_colocalization_df, "frac_coloc_B",
  "Fraction colocalized in B", "HeLa_frac_coloc_B_by_genotype.pdf",
  hela_genotype_colors
)

hela_plot_summary_metrics(
  HeLa_summary_df,
  c("avg_area_HA","avg_area_EEA1","avg_area_VPS35","avg_area_LAMP1","avg_area_RAB7"),
  "Average object area per image",
  "HeLa_summary_avg_area_metrics.pdf",
  hela_genotype_colors
)
hela_plot_summary_metrics(
  HeLa_summary_df,
  c("HA_per_nucleus","EEA1_per_nucleus","VPS35_per_nucleus","LAMP1_per_nucleus","RAB7_per_nucleus"),
  "Objects per nucleus per image",
  "HeLa_summary_per_nucleus_metrics.pdf",
  hela_genotype_colors
)

```

